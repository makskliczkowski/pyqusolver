## 2025-05-23 - [JAX Vectorization with Mixed Arity Operators]
**Learning:** JAX's `vmap` requires uniform array shapes. In `hamil_energy_jax.py`, operator terms were grouped solely by function identity. When a flexible operator function (like a generic Pauli string applier) was used with varying numbers of sites (mixed arity), the grouping logic failed to create a uniform indices array, triggering a fallback to sequential processing. This caused huge compilation times (timeout > 400s for 20k terms) and large graph sizes.
**Action:** Always group by both function identity AND input shape/arity when preparing data for `vmap`. I updated `group_operators` to use `(f, len(idx))` as the key, ensuring each group has uniform structure, enabling efficient vectorization (2.4s compilation for 20k terms).
